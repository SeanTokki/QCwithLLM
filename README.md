# LLM을 활용한 QC 점수 부여 시스템
- 특정 매장의 수집한 데이터를 통해 자동으로 검수 기준에 맞게 점수를 부여하는 시스템
- 특정 매장의 점수를 가져오거나 스코어링 작업을 시작하기 위한 FastAPI 서버 구현
- 총점 = (위치 + 메뉴 + 내외부) / 3 + 추가
- LLM Input은 네이버 지도 크롤링을 통해 수집한 이름, 카테고리, 메뉴, 리뷰, 이미지 등의 데이터
- 위치 점수
    - 수집한 gps 정보와 지하철 역과의 거리 정보 활용해서 부여 (LLM X)
    - 핫플 → 5점 / 신규 핫플, 대학가 → 4점 / 750m 이내 → 3점 / 1250m 이내 → 2점 / 나머지 1점
    - 출력 예시
        
        ```json
        { "score": 3.0, "reason": "역에서 도보 15분 이내" }
        ```
        
- 메뉴 점수
    - 기준 표에 있는 카테고리 및 메뉴와 매장을 매칭하고 해당하는 점수를 부여
    - 카테고리 및 메뉴 점수 기준 예시
        
        ```json
        {
            "top_category": "카페",
            "scoring_rules": [
            {
                "5": ["브런치메뉴 전문","해외 유명 브랜드 카페", ...],
                "4": ["중형 프렌차이즈 카페", "사진 라떼", "녹차 전문 매장", ...],
                "3": ["버블티 매장", "마카롱 전문 카페", "쿠키 전문 카페", ...],
                "2": ["슈 카페", "생과일 주스 전문점", "웰빙 디저트 카페", ...],
                "1": ["아메리카노 전문점", "스터디 카페", ...]
            },
            {
                "5": ["디저트 10개 이상"],
                "4": ["디저트 4종류 이상"],
                "3": ["디저트 전문점", "특성화 매장"],
                "2": ["기성품 매장"],
                "1": ["디저트 없음"]
            }
            ]
        }
        ```
        
    - 지시 사항
        
        ```
        ## Instruction
        - "Matching Rule"을 참고하여 입력으로 주어진 매장에 대해 카테고리 매칭 및 스코어링을 진행합니다.
        - 먼저, 이 매장을 설명하는 가장 적합한 상위 카테고리를 한 개 선택합니다.
        - 선택된 상위 카테고리 안에서 "scoring_rules"의 첫번째 규칙을 보고 적절한 하위 카테고리가 있는지 확인합니다.
        - 만약 적절한 하위 카테고리가 없다고 판단되면 "scoring_rules"의 다음 규칙을 보고 적절한 하위 카테고리가 있는지 확인합니다.
        - 이렇게 계속 진행하다 "scoring_rules"의 마지막 규칙까지 확인했지만 적절한 하위 카테고리가 없다면 하위 카테고리를 ""(빈 문자열)로 설정합니다.
        - 상위/하위 카테고리 매칭을 하면서 했던 생각들을 요약해서 판단에 대한 근거를 작성합니다.
        - 매칭된 하위 카테고리에 해당하는 점수를 부여합니다. 만약 매칭된 하위 카테고리가 없다면 0점을 부여합니다.
        - 반드시 기준 표에 존재하는 카테고리에만 매칭하세요.
        ```
        
    - 출력 예시
        
        ```json
        {
            "top_category": "맛집",
            "sub_category": "텐동(튀김덮밥)",
            "score": 5,
            "reasoning": "매장 이름이 '저스트텐동'이고, 네이버 카테고리가 '일식당'으로 명시되어 있습니다. 메뉴 리스트의 대부분이 '텐동' 종류(저스트텐동, 스페셜텐동, 야채텐동, 에비텐동 등)로 구성되어 있으며, 리뷰에서도 '튀김', '텐동'에 대한 언급이 많습니다. 이는 '맛집' 상위 카테고리 내의 '텐동(튀김덮밥)' 하위 카테고리에 가장 정확하게 부합합니다."
        }
        ```
        
- 내외부 점수
    - 수집한 매장 이미지를 분석하여 기준에 맞게 점수 부여
    - 내외부 점수 기준
        
        ```
        ## Scoring Rule
        1차 검수: 내부 인테리어
        - 5점: 감각적 인테리어, 컨셉 인테리어(예시: 캠핑 컨셉으로 텐트와 캠핑의자, 한옥, 공장 개조형) 루프탑, 다락방, 오션뷰
        - 4점: 전체 특정 컨셉(마법당, 러빈허, 특정 나라 컨셉), 대형 쇼핑몰에 입점한 매장
        - 3점: 특정 컨셉 없는 통일된 톤의 인테리어(조명이 전체적으로 밝은 매장)
        - 2점: 특정 컨셉 없고, 통일되지 않는 톤으로 이루어진 인테리어의 매장
        - 1점: 그 외 매장
        2차 검수: 좌석 수에 따른 점수 부여
        - 30석 초과시 0.5점
        - 30석 이하 10석 초과시 0점
        - 10석 이하시 -0.5점
        ```
        
    - 지시 사항
        
        ```
        ## Instruction
        - "Scoring Rule"을 참고하여 입력으로 주어진 매장의 이미지를 보고 스코어링을 진행합니다.
        - 주어진 매장 이미지의 인덱스는 1부터 시작합니다.
        - 1차 검수를 진행하여 점수를 부여하고 그 근거를 서술합니다.
        - 주어진 이미지 중 1차 검수 과정에서 가장 영향을 크게 미친 하나를 골라 근거로써 첨부할 수 있습니다.
        - 1차 검수에서 주어진 이미지만으로 판단이 불가능할 경우 0점을 부여하고 그 이유를 서술합니다.
        - 2차 검수를 진행하여 점수를 부여하고 그 근거를 서술합니다.
        - 주어진 이미지 중 2차 검수 과정에서 가장 영향을 크게 미친 하나를 골라 근거로써 첨부할 수 있습니다.
        - 2차 검수에서 주어진 이미지만으로 판단이 불가능할 경우, 검색 도구를 사용하여 추가 정보를 획득할 수 있습니다.
        - 추가 정보를 통해서도 판단이 불가능할 경우 0점을 부여하고 그 이유를 서술합니다.
        - 추가 정보를 통해 점수를 부여했다면 꼭 추가정보 내용과 출처를 근거에 포함시킵니다.
        ```
        
    - 출력 예시
        
        ```json
        {
            "name": "신정",
            "first_score": 3.0,
            "first_reason": "매장 내부는 감각적인 컨셉 인테리어나 특정 테마를 가지고 있지는 않습니다. 하지만 이미지 13에서 볼 수 있듯이, 전체적으로 밝은 조명과 통일된 톤의 테이블 및 의자, 그리고 깔끔하게 정돈된 공간을 보여줍니다. 이는 '특정 컨셉 없는 통일된 톤의 인테리어(조명이 전체적으로 밝은 매장)'에 해당하여 3점을 부여합니다.",
            "first_reason_image": "https://pup-review-phinf.pstatic.net/MjAyNDAyMjJfMjM4/MDAxNzA4NTgyOTE2MDY3.ANBkI89rFIDcrdvxUBncH3gs53VsWsMy5nqR7yr7Kx0g.P66P3L7B1hRQP8aLaWvLIejnZmw_d3PRJLtcNxYK4wMg.JPEG/20240222_133206.jpg.jpg?type=w560_sharpen",
            "second_score": 0.5,
            "second_reason": "이미지 13에서 매장 내부의 넓은 공간과 다수의 테이블이 확인됩니다. 대략적으로 보이는 좌석만으로도 30석을 초과할 것으로 예상됩니다. 정확한 좌석 수를 확인하기 위해 검색한 결과, '신정'은 30석을 초과하는 대형 매장으로 확인됩니다. 따라서 2차 검수 조건에 따라 0.5점이 부여됩니다. [1]",
            "second_reason_image": "https://pup-review-phinf.pstatic.net/MjAyNDAyMjJfMjM4/MDAxNzA4NTgyOTE2MDY3.ANBkI89rFIDcrdvxUBncH3gs53VsWsMy5nqR7yr7Kx0g.P66P3L7B1hRQP8aLaWvLIejnZmw_d3PRJLtcNxYK4wMg.JPEG/20240222_133206.jpg.jpg?type=w560_sharpen",
            "total_score": 3.5
        }
        ```
         
- 추가 점수
    - 수집한 데이터와 검색 도구를 통해서 각 추가 점수 항목에 해당하는지 판단 후 점수 부여
    - 수집 데이터에서 바로 확인이 가능한 항목(미쉐린, 주차, 블로그)의 경우 외부에서 따로 처리
    - 추가 점수 기준
        
        ```
        ## Scoring Rule
        - TV 맛집 방영매장: +0.5
        - TV 드라마 방영매장: +0.3
        - TV 다큐멘터리 방영매장: +0.3
        - 유명인/연예인 사장: +0.3
        - 최소 3일전 예약 필수: -0.3
        - 일회용잔 카페: -0.2
        - 주기적 상품 변동: -0.3
        
        ## Additional Rule
        - TV 방영 여부를 따질 때 유튜브는 포함되지 않습니다.
        - TV 방영의 조건은 해당 매장에 대한 언급이 있거나 해당 매장이 화면에 나왔어야 합니다.
        - 유명인/연예인은 누구나 알만한 사람이어야 합니다.
        - 신메뉴 출시는 주기적 상품 편동에 해당하지 않습니다.
        - 꼭 "주기적"으로 메뉴가 변하는 것이 확인되었을 경우에만 주기적 상품 변동에 해당합니다.
        - 일회용잔 카페는 "항상" 일회용품만 사용하는 "카페" 일때만 해당합니다.
        ```
        
    - 지시 사항
        
        ```
        ## Instruction
        - "Scoring Rule"과 "Additional Rule"을 참고하여 입력으로 주어진 매장의 정보를 활용해 모든 추가 점수 항목에 대해 이 매장이 해당하는지 확인합니다.
        - 주어진 정보만으로는 확인되지 않는 항목에 대해서는 검색을 통해서 알아볼 수 있습니다.
        - 각 항목에 대해 이 매장이 해당한다면 왜 해당하는지, 해당하지 않는다면 왜 해당하지 않는지 이유를 서술합니다.
        - 검색을 사용하여 얻은 정보를 통해 판단한 항목에 대해서는 반드시 검색 내용을 이유에 포함시킵니다.
        ```
        
    - 출력 예시
        
        ```json
        {
            "name": "고반식당 가로수길점",
            "items": [
            {
                "item": "TV 맛집 방영매장",
                "score": 0.5,
                "selected": true,
                "reason": "검색 결과, 고반식당은 '식신로드'에 출연한 맛집으로 언급되며 [18], 과거 TV에 방영된 적이 있다는 내용이 확인됩니다 [23]."
            },
            {
                "item": "TV 드라마 방영매장",
                "score": 0.3,
                "selected": true,
                "reason": "검색 결과, 고반식당 브랜드는 KBS 2TV 드라마 '미녀와 순정남' [3] 및 tvN 토일드라마 '엄마친구아들' [4, 5, 24, 25] 의 제작을 지원했습니다. 이는 드라마를 통한 브랜드 노출을 의미합니다."
            },
            {
                "item": "블로그 리뷰 300개",
                "score": 0.3,
                "selected": true,
                "reason": "수집 데이터에서 블로그 리뷰 수가 1413개 입니다."
            },
            {
                "item": "자체 주차장 보유",
                "score": 0.2,
                "selected": true,
                "reason": "수집 데이터에서 주차 가능 여부를 찾았습니다."
            }
            ],
            "score": 1.3
        }
        ```